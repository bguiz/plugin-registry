<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - qryq</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="qryq" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/PluginRegistry.html">PluginRegistry</a></li>
                                <li><a href="../classes/PluginRegistryFluentInterface.html">PluginRegistryFluentInterface</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/PluginRegistry.html">PluginRegistry</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

var path = require(&#x27;path&#x27;);

var DEFAULT_PLUGIN_CATEGORY = &#x27;task&#x27;;
var DEFAULT_REGISTRY_NAME = &#x27;DEFAULT_REGISTRY&#x27;;

/**
 * @module  PluginRegistry
 */

/**
 * @class  PluginRegistry
 */

function isAbsolutePath(pathToTest) {
  //NOTE &#x60;path.isAbsolute()&#x60; is not available on NodeJs 0.10.x
  return (path.resolve(pathToTest) === path.normalize(pathToTest));
}

function parsePluginDefinition(pluginDefinition, context) {
  if (typeof pluginDefinition === &#x27;string&#x27;) {
    pluginDefinition = {
      category: (context.defaultPluginCategory || DEFAULT_PLUGIN_CATEGORY),
      name: pluginDefinition
    };
  }

  var name = pluginDefinition.name;

  // attempt to determine requirePath from name
  if (typeof name !== &#x27;string&#x27; || name.length &lt; 1) {
    throw new Error(&#x27;Plugins should have a name&#x27;);
  }

  // attempt to determine requirePath from name
  if (typeof pluginDefinition.category !== &#x27;string&#x27; ||
    pluginDefinition.category.length &lt; 1) {
    throw new Error(&#x27;Plugins should have a category&#x27;);
  }

  var failedRequirePaths = [];
  var pathsToTest;
  if (typeof pluginDefinition.requirePath === &#x27;string&#x27;) {
    if (!isAbsolutePath(pluginDefinition.requirePath)) {
      throw new Error(&#x27;Require path specified should be an absolute path&#x27;);
    }
    pathsToTest = [pluginDefinition.requirePath];
  }
  else {
    var toolPath = context.toolPath;
    if (!toolPath) {
      // Attempt to determine the path of the file which **first** required
      // this module, and assume that that is the tool path (only when not specified)
      var parentPath = module.parent &amp;&amp; module.parent.id;
      /* istanbul ignore else :
        This is not possible to test in jasmine, as the spec file needs to require this file */
      if (typeof parentPath === &#x27;string&#x27;) {
        toolPath = path.dirname(module.parent.id);
      }
      else {
        toolPath = path.resolve(__dirname, &#x27;../..&#x27;);
      }
      context.toolPath = toolPath;
    }

    var projectPath = context.projectPath;
    if (!projectPath) {
      projectPath = path.resolve(&#x27;.&#x27;);
      context.projectPath = projectPath;
    }

    if (!isAbsolutePath(toolPath)) {
      throw new Error(&#x27;Tool path should be an absolute path&#x27;);
    }
    if (!isAbsolutePath(projectPath)) {
      throw new Error(&#x27;Project path should be an absolute path&#x27;);
    }

    pathsToTest = [
      // first, check if this plugin is installed as one of tool&#x27;s own dependencies
      path.resolve(toolPath, &#x27;node_modules&#x27;, name),
      // if not, check if this plugin is installed in the local project
      path.resolve(projectPath, &#x27;node_modules&#x27;, name),
      // lastly, check if this plugin is installed as a global installation
      // (sibling folder to tool itself)
      path.resolve(toolPath, &#x27;..&#x27;, name)
    ];
  }

  var requirePath;
  var plugin;
  pathsToTest.forEach(function testPossibleRequirePathForPlugin(pathToTest) {
    if (!requirePath) {
      try {
        plugin = require(pathToTest);
        // If require of the path did not throw, then we should use this path
        requirePath = pathToTest;
      }
      catch (e) {
        // Do nothing
        failedRequirePaths.push(pathToTest);
      }
    }
  });

  // if none of these exist, then the plugin cannot be found
  // fail immediately
  if (!requirePath) {
    throw new Error([
      &#x27;Unable to find require path for plugin named &#x27;+name+&#x27;:&#x27;
    ]
      .concat(failedRequirePaths.map(function(aPath) {
        return &#x27;\t&#x27;+aPath;
      }))
      .join(&#x27;\n&#x27;));
  }
  /* istanbul ignore if :
     This code path should not be possible to hit due to comprehensive
     validation earlier in this function of toolPath and projectPath
     However, for for correctness reasons, this check is still included */
  else if (!isAbsolutePath(requirePath)) {
    throw new Error(&#x27;Require path should resolve to an absolute path&#x27;);
  }
  else {
    pluginDefinition.requirePath = requirePath;
    pluginDefinition.plugin = plugin;
  }

  return pluginDefinition;
}

var registries = {};

/**
 * @method get
 * @for  PluginRegistry
 * @param  registryName {String}
 * @return {PluginRegistryFluentInterface}
 */
function get(registryName) {
  var context = {};
  var contextHasBeenSet = false;

  if (!registryName) {
    registryName = DEFAULT_REGISTRY_NAME;
  }
  if (typeof registryName !== &#x27;string&#x27; || registryName.length &lt; 1) {
    throw new Error(&#x27;Invalid name for registry&#x27;);
  }
  var fluent = registries[registryName];

  // If a registry by this name exists, simply return it
  // (Multiton pattern)
  if (!!fluent) {
    return fluent;
  }

  // Otherwise create a new registry with a fluent interface,
  // cache it, then return it

  /**
   * @class PluginRegistryFluentInterface
   */
  fluent = {
    registry: {},
    context: setContext,
    add: addPlugins,
    getAllOfCategory: getAllPluginsOfCategory,
    getFullRegistry: getFullPluginRegistry,
    getContext: getContext,
  };

  /**
   * @method setContext
   * @for  PluginRegistryFluentInterface
   * @chainable
   * @param newContext {Object}
   */
  function setContext(newContext) {
    if (!newContext) {
      throw new Error(&#x27;Invalid context&#x27;);
    }
    if (contextHasBeenSet) {
      throw new Error(&#x27;Can only set context once for registry &#x27;+registryName);
    }
    context = newContext;
    contextHasBeenSet = true;

    return fluent;
  }

  /**
   * @method addPlugins
   * @for  PluginRegistryFluentInterface
   * @chainable
   * @param ...plugins {String|PluginDefinition}
   */
  function addPlugins() {
    var argumentsAsArray = Array.prototype.slice.apply(arguments);
    var pluginDefinitions = [];
    argumentsAsArray.forEach(function(argument) {
      pluginDefinitions = pluginDefinitions.concat(argument);
    });
    pluginDefinitions.forEach(addPluginImpl);
    return fluent;
  }

  /**
   * @method addPluginImpl
   * @for  PluginRegistryFluentInterface
   * @param pluginDefinition {String|PluginDefinition}
   * @private
   */
  function addPluginImpl(pluginDefinition) {
    var parsedDefinition = parsePluginDefinition(pluginDefinition, context);

    // add to the appropriate registry
    var category = parsedDefinition.category;
    var registryCategory = fluent.registry[category];
    if (!registryCategory) {
      registryCategory = [];
      fluent.registry[category] = registryCategory;
    }
    registryCategory.push(parsedDefinition);
  }

  /**
   * @method getAllPluginsOfCategory
   * @for  PluginRegistryFluentInterface
   * @chainable
   * @param category {String}
   */
  function getAllPluginsOfCategory(category) {
    return (fluent.registry[category] || []);
  }

  /**
   * @method getFullPluginRegistry
   * @for  PluginRegistryFluentInterface
   */
  function getFullPluginRegistry() {
    return fluent.registry;
  }

  /**
   * @method getContext
   * @for  PluginRegistryFluentInterface
   */
  function getContext() {
    return context;
  }

  registries[registryName] = fluent;

  return fluent;
}

/**
 * @method reset
 * @for  PluginRegistry
 */
function reset() {
  registries = {};
}

module.exports = {
  get: get,
  reset: reset,
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
